## Bitconex package subscription

Author: Adnan Ibric

The project is generated by [LoopBack](http://loopback.io).

#### Task description

[Click to open](https://github.com/aibric1407/bitconex/blob/master/BITConEx%20-%20Projektni%20Zadatak.pdf)

#### Installation

1. Clone the repository

```sh
$ git clone https://github.com/aibric1407/bitconex.git
```

2. Install dependencies

```sh
$ cd bitconex
$ npm install
```

3. Run the app

```sh
$ npm start
```

**When app is started you will get the message:**
```
Web server listening at: http://localhost:3000
Browse your REST API at http://localhost:3000/explorer
```
When opening explorer you will get user interface for communication with api.

![Explorer](explorer.png)


#### Unit test
Run the test

```sh
$ npm test
```

#### Description

- App is using memory db (json file) specified in server/datasources.json
- All config values are in server/config.json
- On first run app crates default techs, devices and packages data.
  
#### Models
- Device 

| Fields   | Description       |
| ------- | ----------------- |
| id | device id           |
| type      | device type |

- Tech

| Fields   | Description       |
| ------- | ----------------- |
| id | tech id           |
| type      | tech type |

- Product

| Fields   | Description       |
| ------- | ----------------- |
| id | product id           |
| downstream      |  downstream |
| upstream      | upstream |
| device_id      | device |
| tech_id      | tech |

- Subscription

| Fields   | Description       |
| ------- | ----------------- |
| id | subscription id           |
| user_id      | user id |
| product_id      | product id |
| date      | date of subscription |

- History

| Fields   | Description       |
| ------- | ----------------- |
| id | subscription id           |
| user_id      | user id |
| product_id      | product id |
| date      | date of subscription |

 #### Functions
<dl>
<dt><a href="#allProducts">allProducts()</a></dt>
<dd><p>Fetch all products. Include tech and device details
</p>
</dd>
<dt><a href="#beforeRemote - activateSubscription">beforeRemote - activateSubscription()</a></dt>
<dd><p>Check if request is valid. If subscription already exists push it into History
and then proceed with activateSubscription method. Otherwise proceed.</p>
</dd>
<dt><a href="#activateSubscription">activateSubscription(req, cb)</a> ⇒</dt>
<dd><p>Check if params are valid and if wanted product is in system. If conditions are met
create new subscription for user</p>
</dd>
<dt><a href="#getActiveSubscriptions">getActiveSubscriptions(cb)</a> ⇒</dt>
<dd><p>Fetch active subscriptions for all users. Include tech and device details</p>
</dd>
<dt><a href="#getActiveUserSubscription">getActiveUserSubscription(user_id, cb)</a> ⇒</dt>
<dd><p>Fetch active subscription for wanted user id. Include tech and device details.</p>
</dd>
<dt><a href="#getSubscriptionsHistory">getSubscriptionsHistory(cb)</a> ⇒</dt>
<dd><p>Fetch subscriptions history for all users. Include tech and device details</p>
</dd>
<dt><a href="#getSubscriptionHistoryForUser">getSubscriptionHistoryForUser(user_id, cb)</a> ⇒</dt>
<dd><p>Fetch subscription history for wanted user id. Include tech and device details.</p>
</dd>
</dl>

<a name="allProducts"></a>

## allProducts(cb) ⇒
Fetch all products. Include tech and device details

**Kind**: global function  
**Returns**: subscriptions list of active subscriptions for all users  

| Param | Description |
| --- | --- |
| cb | callback function |

**Example**  
```js
GET http://localhost:3000/api/Products/list
```

<a name="beforeRemote - activateSubscription"></a>

#### beforeRemote - activateSubscription()
Check if request is valid. If subscription already exists push it into History
and then proceed with activateSubscription method. Otherwise proceed.

**Kind**: global function  
<a name="activateSubscription"></a>

#### activateSubscription(req, cb) ⇒
Check if params are valid and if wanted product is in system. If conditions are met
create new subscription for user

**Kind**: global function  
**Returns**: message  

| Param | Description                               |
| ----- | ----------------------------------------- |
| req   | requst object with user_id and product_id |
| cb    | callback function                         |

**Example**  
```js
POST http://localhost:3000/api/Subscriptions/activate-subscription?req={"user_id": 123, "product_id": 12}
```
<a name="getActiveSubscriptions"></a>

#### getActiveSubscriptions(cb) ⇒
Fetch active subscriptions for all users. Include tech and device details

**Kind**: global function  
**Returns**: subscriptions list of active subscriptions for all users  

| Param | Description       |
| ----- | ----------------- |
| cb    | callback function |

**Example**  
```js
GET http://localhost:3000/api/Subscriptions/subscriptions
```
<a name="getActiveUserSubscription"></a>

#### getActiveUserSubscription(user_id, cb) ⇒
Fetch active subscription for wanted user id. Include tech and device details.

**Kind**: global function  
**Returns**: subscription active subscription for wanted users  

| Param   | Description       |
| ------- | ----------------- |
| user_id | user id           |
| cb      | callback function |

**Example**  
```js
GET http://localhost:3000/api/Subscriptions/user-subscription?user_id=123
```
<a name="getSubscriptionsHistory"></a>

#### getSubscriptionsHistory(cb) ⇒
Fetch subscriptions history for all users. Include tech and device details

**Kind**: global function  
**Returns**: subscription subscription history for all users  

| Param | Description       |
| ----- | ----------------- |
| cb    | callback function |

**Example**  
```js
GET http://localhost:3000/api/Subscriptions/subscription-history
```
<a name="getSubscriptionHistoryForUser"></a>

#### getSubscriptionHistoryForUser(user_id, cb) ⇒
Fetch subscription history for wanted user id. Include tech and device details.

**Kind**: global function  
**Returns**: subscription subscription history for wanted users  

| Param   | Description       |
| ------- | ----------------- |
| user_id | user id           |
| cb      | callback function |

**Example**  
```js
GET http://localhost:3000/api/Subscriptions/user-subscription-history?user_id=123
```